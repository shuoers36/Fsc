<%@ page contentType="text/html; charset=utf-8" language="java" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>  
<!DOCTYPE html>
<html>
<head>
  <title>首页</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="scripts/jquery.min.js"></script>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <script src="scripts/bootstrap.min.js"></script>
  <style>
   html {
      width: 100%;
      height: 100%;
    }
    body {
      margin: 0 auto;
      width: 100%;
      background: #fff;
      font-size: .625em;
    }
    #nav {
      width: 100%;
      height: 8em;
      background: #5a6378;
    }
    #nav h2 {
      display: inline-block;
      margin-top: 15px;
      margin-left: 50px;
      color: #ddd;
      font-size: 4em;
      text-shadow: 2px 2px 10px #fff;
    }
    #nav h3 {
      color: #ddd;
      font-size: 2.6em;
      float: right;
      margin-right: 6em;
    }
    #nav a {
      display: inline-block;
      text-decoration: none;
      font-size: 2.6em;
      color: #aaa;
      float: right;
      margin-right: -6.5em;
      margin-top: 1em;
    }
    #left-list {
      width: 18%;
      height: 100%;
      float: left;
      background: #324;
    }
    #content-list {
      float: left;
      width: 82%;
      background: #f2f0f1;
    }
    #content-list form {
      margin-top: 20px;
    }
    #left-list li {
      background: transparent;
      color: #fff;
      font-size: 2em;
      line-height: 2em;
      padding-left: 30px;
    }
    #left-list li a {
      color: #fff;
      text-decoration: none;
    }
 
    #left-list li:last-child {
      border: 1px solid #fff;
    }
  
    table {
    font-size: 2.3em;
    color: #444;
    }
    table .item {
      background: #ccc;
    }
    table td a:first-child {
      margin-right: 1em;
    }
    table td a+a {
      margin-left: 1em;
    }
    table td {
      width:  25%;
    }
   
    #query {
      margin-left: 70px;
      margin-bottom: .4em;
      font-size: 2.4em;
      color: #444;     
      display: inline-block;
    }
    #search-name {
    	margin-bottom: 0;
    	display: none;
    }
  </style>
</head>
<body>
  <div id="container">
      <div id="nav">
             <h2>Xidian-16 </h2>
             <h3>管理员</h3>
             <a>注销</a>
      </div>
  </div>
 <div id="left-list">
   <ul class="list-group">
    <li class="list-group-item"><a href="#user_manage">用户管理</a></li>
    <li class="list-group-item">
        <span class="badge">新</span>
        公告管理
    </li>
    <li class="list-group-item">班级管理</li>
</ul> 
 </div>
 <div  id="content-list">
   <div id="user_manager">
   <form id="query" class="form-inline ">
     <label for="queryname" class="control-label">用户名</label>
    <input type="text" name="queryname" class="form-control"  id="queryname">
      <button type="button" class="btn btn-primary form-control" id="search">搜索</button> 
      <input class="btn btn-primary form-control " type="submit" value="增加新用户" id="add-user">    
  </form>
    <table class="table table-bordered table-condensed table-responsive" id="search-name">
    	<tr id="getuname">
    		<td></td>
        	<td></td>
        	<td></td>
        	<td><a href="" class="del-user">修改</a>|<a href="" class="del-user">删除</a></td>
    	</tr>
    </table>
    <div class="table-responsive">
    <table class="table table-bordered table-condensed" id="search-all">
        <thead>
            <tr class="item">
                <th>ID</th>
                <th>用户名</th>
                <th>密码</th>
                <th>管理操作</th>
            </tr>
        </thead>
        <tbody id="lis">
            <c:forEach items="${nulist}" var="node">  
      <tr>
        <td><c:out value="${node.id}"></c:out></td>
        <td><c:out value="${node.userName}"></c:out></td>
        <td><c:out value="${node.password}"></c:out></td>
        <td><a href="" class="del-user">修改</a>|<a href="" class="del-user">删除</a></td>
      </tr>
   </c:forEach>  
        </tbody>
    </table>
</div> 
  
    <form method="post" id="userForm" name="userForm"></form>
  
  
   </div>
 </div>
 <script>
    //页面加载时自动提交查询列表请求并显示
 	window.onload = function (){
      $.post("usermanage.do?type=query", function (nlist){
    	 $("body").html(nlist); 
      }); 
      
    };
    //dom加载过程中动态计算背景高度
    $(document).ready (function (){
        var height = $("#content-list").offset().top;
        $("#content-list").height($(document).height()-height-10);
        $("#left-list").height($(document).height()-height-10);
      });
    $(".del-user").click(function (event) {
        event.preventDefault();
        var querystr=$(this).parent().parent().children().first().text();
    $("#userForm").attr("action","usermanage.do?type=delete&User_id="+querystr).submit();
      }); 
    
   /*  ajax查询单个用户
                  判断Json对象是否为空
     function isEmptyObject(e) {
    	var t;
    	for (t in e)
    		return !1;
    	return !0;
    } */
   	
    $("#search").click(function searchName(){
      var querystr2=$("#queryname").val();
      $.ajax({ url: "usermanage.do", data:"type=query&User_name="+querystr2,type: "post",dataType: "json",context: $("#getuname"), success: function(data){
       var auser = data.uu;
       console.log(auser);
    	if (auser.id !== 0){
       $(this).children().eq(0).html(auser.id);
       $(this).children().eq(1).html(auser.userName);
       $(this).children().eq(2).html(auser.password);
       $("#search-name").show();
     }
      else {
        $(this).html("该用户不存在");
      }
      },error: function(){
          alert("error");} });     
     });
    	$("#queryname").keydown(function (e){
    		if(e.keyCode == 13) {
    			 e.preventDefault();
    			 console.log("ss");
    			 $("#search").click();
    		}
    	});
    
 </script>
</body>
</html>